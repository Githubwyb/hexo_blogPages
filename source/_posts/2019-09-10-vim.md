---
title: vi/vim命令学习
date: 2019-09-10 17:30:57
tags: [Linux]
categories: [Program, Shell]
top: 7
---

# 常用配置

## 编码

1. `encoding`：VIM 使用的字符编码格式，包括 VIM 的 buffer (缓冲区)、菜单文本、消息文本等。可在~/.vimrc 中改变它的值，如果打开的文件编码与该属性配置的编码不同，那么VIM会将编码自动转换到这种编码然后再显示。
2. `fileencoding`：VIM 当前编辑的文件的字符编码方式，VIM保存文件时也会将文件保存为这种字符编码方式 (不管是否新文件都如此)；如果它的值与encoding不一样，那么保存的时候VIM会自动把文件内容由encoding的编码转换为fileencoding配置编码再保存。而读取文件的时候，该选项的值会自动同步为fileencodings配置的有效编码。
3. `fileencodings`：此项目配置的是一个编码列表，止Vim在读取文件的时候，会按照它所列出的字符编码方式逐一探测即将打开的文件的字符编码方式，并且将 fileencoding 设置为最终探测到的字符编码方式。因此最好将 Unicode 编码方式放到这个列表的最前面。
4. `termencoding`：VIM 所工作的终端 (或者 Windows 的 Console 窗口) 的字符编码方式。这个选项在 Windows 下对我们常用的 GUI 模式的 gVim 无效，而对 Console 模式的 Vim 而言就是 Windows 控制台的代码页，并且通常我们不需要改变它。

## 读取和保存

```vim
    set autoread        " 外部改动自动读取
    set autowriteall    " 和autowrite类似，不过支持跳转命令保存
```

## 高亮

取消高亮

```vim
    set nohlsearch
    set noh
```

## 行号

```vim
    set number     " 显示行号
    set nonumber   " 取消显示行号
```

## tab缩进

```vim
    set tabstop=4           " 4个空格识别成tab，读到的\t解释成4个空格
    set softtabstop=4       " tab输入为4个空格宽度
    set shiftwidth=4        " 换行时的自动缩进列数
    set expandtab           " 输入tab转成空格
    set noexpandtab         " 输入tab不转成空格
    set autoindent          " 自动缩进
    set smartindent         " 智能缩进
    filetype indent on      " 不同文件使用不同缩进
```

## 状态栏

```vim
    set laststatus=2    " 显示状态栏
    set ruler           " 显示鼠标所在行数在状态栏
    set cursorline      " 高亮光标所在行
```

## 代码高亮

```vim
    syntax on           " 代码高亮
    colorscheme xxx     " 配色方案采用xxx
```

系统配色方案

```shell
    ~|⇒ ls /usr/share/vim/vim74/colors
    blue.vim      delek.vim    evening.vim  murphy.vim     README.txt  slate.vim
    darkblue.vim  desert.vim   koehler.vim  pablo.vim      ron.vim     torte.vim
    default.vim   elflord.vim  morning.vim  peachpuff.vim  shine.vim   zellner.vim
```

### 添加配色方案

```shell
    git clone https://github.com/xxx
    mv xxx/colors ~/.vim/colors
```

- 在vimrc里面添加`colorscheme xxx`即可

### 推荐配色方案

- molokai: `https://github.com/tomasr/molokai.git`

## 搜索

```vim
    set hlsearch    " 高亮搜索结果
    set incsearch   " 输入字符串实时跳转到搜索结果
    set ignorecase  " 忽略大小写
```

## 折叠

```vim
    set foldenable          " 开启折叠
    set foldlevel=999       " 设置折叠级别为999，也就是不自动折叠
    set foldmethod=indent   " 使用按照缩进折叠的模式
```

# 常用命令

- `i`: 进入编辑模式
- `esc`: 退出编辑模式
- `u`: 撤销
- `Ctrl + r`: 重做
- `shift + *`: 向下查找并高亮光标所在单词
- `shift + #`: 向上查找并高亮光标所在单词
- `g + b`: 从头查找并高亮光标所在单词
- `:noh`: 取消高亮
- `Ctrl + o`: 调回上次光标位置
- `Ctrl + i`: 跳到下一次光标位置
- `/xxx`: 当前文件搜索字符串
- `n`: 跳到下一个搜索位置
- `N`: 跳到上一个搜索位置
- `:xxx`: 跳转当前文件行号
- `:w`: 保存更改
- `:q`: 退出当前窗口
- `:q!`: 不保留更改退出当前窗口
- `:qa`: 退出所有窗口
- `ve`: 选择模式
- `gf`: 跳转到光标所在的文件

## 分屏

- `vs`: 横向分屏
- `split`: 纵向分屏
- `Ctrl + w, (n), shift + >`: 横向扩充窗口大小n，默认为1
- `Ctrl + w, (n), shift + <`: 横向减少窗口大小n，默认为1
- `Ctrl + w, (n), shift + +`: 纵向扩充窗口大小n，默认为1
- `Ctrl + w, (n), shift + -`: 纵向减少窗口大小n，默认为1
- `Ctrl + w, h`: 跳转到左侧窗口
- `Ctrl + w, l`: 跳转到右侧窗口
- `Ctrl + w, j`: 跳转到上侧窗口
- `Ctrl + w, k`: 跳转到下侧窗口

## 全局搜索

### 命令

```vim
    vimgrep /xxx/ ./xxx/xxx/*/*.*       " 搜索xxx，在xxx/xxx/下的一级子目录所有文件
    vimgrep /xxx/ ./xxx/xxx/**/*.*      " 搜索xxx，在xxx/xxx/下的所有目录下的所有文件
    vimgrep /xxx/j ./xxx/xxx/**/*.*     " 搜索xxx，在xxx/xxx/下的所有目录下的所有文件，j不跳转
```

### 快捷键

- `:cn`: 跳转下一个定义
- `:cp`: 条状上一个定义
- `:copen`: 打开搜索结果

## 折叠

- `z + c`: 折叠
- `z + o`: 不折叠

### 从m行到n行折叠

- `:set foldmethod=manual`: 设置折叠方式为手工折叠
- `:(m),(n)fo`: m行到n行折叠

## 文件比对

### 命令

```vim
    :diffthis    " 当前文件加入对比
```

### 快捷键

- `d + p`: 应用到另一个文件
- `d + o`: 应用到本文件

## 小技巧

### 多行缩进

1. `ve`进入VISUAL状态
2. 选中多行
3. `(n), shift + >`缩进n次，默认1；`(n), shift + <`缩退n次，默认1

### 粘贴不乱缩进

1. `:set paste`进入粘贴模式
2. 粘贴将不会自动缩进
3. `:set nopaste`退出粘贴模式

# 配置vimIde的各项插件

## 插件安装统一方法

### 下载

```shell
    git clone https://github.com/xxx ~/.vim/bundle/xxx
    cd ~/.vim/bundle/xxx        # 到目录查看
    git tag                     # 查看版本号
    git checkout xxxx           # 切换到需要的版本
```

### 配置

在`.vimrc`里面添加

```vim
    set rtp+=~/.vim/bundle/xxx
```

## 文件树插件 NERDTree

https://github.com/scrooloose/nerdtree.git

### 配置

```vim
    " 设置打开文件树的快捷键为F10
    map <F10> :NERDTreeToggle<CR>
    let g:NERDTreeShowHidden=1      " 显示隐藏文件
```

### 快捷键

- `shift + c`: 切换当前目录为工作目录
- `cd`: 切换光标所在目录为vim所在路径
- `shift + i`: 显示和不显示隐藏文件
- `r`: 刷新光标所在目录
- `m`: 编辑当前目录
- `s`: 横向分屏打开文件
- `i`: 纵向分屏打开文件

## C/C++格式化 clang-format

https://github.com/rhysd/vim-clang-format.git

### 配置

```vim
    let g:clang_format#auto_format_on_insert_leave=1  " 在离开编辑模式时自动格式化
```

## 标签树 taglist

https://github.com/vim-scripts/taglist.vim.git

### 配置

- 需要ctags的支持，自行安装
- 小技巧查看[ctags](/2019/09/12/2019-09-12-softwareTips/#ctags)

```vim
    " F9作为taglist的快捷键
    map <F9> :TlistToggle<CR>
    let Tlist_Exit_OnlyWindow=1     " 如果taglist是最后一个窗口，退出vim
    let Tlist_Use_Right_Window=1    " taglist窗口在右侧
```

## 代码提示 tabnine

https://github.com/zxqfl/tabnine-vim.git

## 多行注释插件 nerdcommenter

https://github.com/scrooloose/nerdcommenter.git

### 快捷键

- `\cc`: 注释单行
- `\c<space>`: 取消注释

## 自动补全括号 auto-pairs

https://github.com/jiangmiao/auto-pairs.git

## nerdtree的git插件 nerdtree-git-plugin

https://github.com/Xuyuanp/nerdtree-git-plugin.git

## 文件搜索 fzf

### 安装配置

安装

```shell
    git clone https://github.com/junegunn/fzf.git           # 克隆fzf到本地
    sudo mv fzf /opt/                                       # 移动fzf到opt目录 
    /opt/fzf/install                                        # 安装fzf到本地
    git clone https://github.com/junegunn/fzf.vim.git ~/.vim/bundle/fzf.vim     # 克隆fzf的vim插件到bundle目录
```

配置

```vim
    set rtp+=/opt/fzf               " 添加fzf软件支持
    set rtp+=~/.vim/bundle/fzf.vim  " 添加fzf的vim插件支持
```

### 快捷键

- `:FZF`: 模糊搜索当前目录下及子目录的文件
- `:Lines`: 模糊搜索打开过的文件中某一行字段

