---
title: python学习笔记
date: 2018-09-16 13:17:51
tags:
categories: [Program, Python]
top: 17
---

# 环境

```
Python 3.6.4
```

# 一、安装配置

## 1. pip包管理器

### 1.1. 安装

安装相应python的版本的pip

```shell
sudo apt install python3-pip
ln -s /usr/bin/pip3 /usr/bin/pip    # 将pip3使用pip命令代替，创建一个快捷方式
```

apt安装的pip一般只有8.1版本，而最新已经有19.1版本了，所以安装后使用pip自己更新自己

```shell
pip install -U pip
```

更新后执行`pip -V`会报错，因为老的pip文件api和新的没对上，需要修改`/usr/bin/pip`如下，主要是`main`需要换成`__main__`

```python
#!/usr/bin/python3
# GENERATED BY DEBIAN

import sys

# Run the main entry point, similarly to how setuptools does it, but because
# we didn't install the actual entry point from setup.py, don't use the
# pkg_resources API.
from pip import __main__
if __name__ == '__main__':
    sys.exit(__main__._main())
```

### 1.2. 配置pip源

```shell
mkdir ~/.pip
vim ~/.pip/pip.conf
```

```conf
[global]

# 从清华大学镜像源
index-url = https://pypi.tuna.tsinghua.edu.cn

# 内部私有pypi服务
extra-index-url = xxx

[install]
trusted-host = pypi.tuna.tsinghua.edu.cn
```

### 1.3. 生成requirements.txt

```shell
pip freeze > requirements.txt
```

### 1.4. pip安装失败，无法再使用pip怎么办

```shell
# 修复本地的pip
python -m ensurepip
```

## 2. jupyter notebook

### 安装

使用pip安装没有找到怎么命令行调用，使用apt可以直接命令行调用

```shell
    sudo apt install jupyter-notebook
```

### 配置远程访问

```shell
    ~|⇒ jupyter notebook --generate-config      # 生成jupyter配置文件
    Writing default config to: /home/you/.jupyter/jupyter_notebook_config.py
    ~|⇒ jupyter notebook password               # 设置远程访问密码
    Enter password:
    Verify password:
    [NotebookPasswordApp] Wrote hashed password to /home/wangyubo/.jupyter/jupyter_notebook_config.json
```

编辑`jupyter_notebook_config.py`，找到以下配置，改成这样

```python
    c.NotebookApp.ip = '*'              # 允许所有ip访问
    c.NotebookApp.open_browser = False  # 不自动打开浏览器
    c.NotebookApp.port = 8888           #可自行指定一个端口, 访问时使用该端口
```

# 二、语法相关

参考文档: [W3Cschool][1]、[Runoob][2]

[1]: https://www.w3cschool.cn/uqmpir/
[2]: http://www.runoob.com/python/python-tutorial.html


## 1. 指定编码格式

源文件第一行或第二行直接定义

```python
# coding=utf-8
```

或者

```python
# -*- coding:utf-8 -*-
```

## 2. 变量

### None

- None是一个特殊的常量。
- None和False不同。
- None不是0。
- None不是空字符串。
- None和任何其他的数据类型比较永远返回False。
- None有自己的数据类型NoneType。
- 你可以将None赋值给任何变量，但是你不能创建其他NoneType对象。

python中矩阵索引使用None表示此维度不切片，同样意味着此维度大小未知

### del 删除一个变量释放空间

```python
del var
```

## 3. 字符串操作

### 替换字符串

```python
str = 'abc'
# 替换字符串，以返回值形式返回，不会在原数据做更改
str = str.replace('b', '')
```

### 删除首位空格（包括换行符）

```python
str = str.dropip()
```

### 和ASCII码之间的转换

```python
# 转ASCII码，仅单个字符
print(ord('a'))
# ASCII码转字符，仅单个ascii码
print(chr(97))
```

## 4. 类

### 4.1. 类的几个特殊函数

**1. 构造函数**

```python
class Test(object):
    def __init__(self, a):
        self.a = a

tmp = Test(1)
tmp = Test()        # 报错，需要传入1个参数
```

**2. 字符串输出**

- 将类作为字符串时，会自动调用此函数输出

```python
class Test(object):
    def __str__(self):
        return f'ccccccc Test xxxxxxx'

tmp = Test()
print(tmp)
print(str(tmp))
```

### 4.2. 多态

**1. 虚函数**

```python
from abc import abstractmethod

class Base(object):
    @abstractmethod
    def test_func(self):
        pass

```

## 遍历

### for遍历list

```python
listValues = list(xxx)

for value in listValues:
    print(value)
    value = 'a'     # list本身不会修改

for index in range(len(listValues)):
    print(listValues[index])
    listValues[index] = 'a'         # list本身会修改

for index, value in enumerate(listValues):
    print(value)
    value = 'a'                 # list不会修改
    listValues[index] = 'a'     # list会修改

```

- 普通的`for value in listValues:`无法修改list的值，list值修改只能用index的方式

## 函数

### lambda 匿名函数

```python
lambda arg1, arg2, ...argN : expression using arguments
```

#### 注意

- lambda 函数不能包含命令，包含的表达式不能超过一个。不要试图向 lambda 函数中塞入太多的东西；如果你需要更复杂的东西，应该定义一个普通函数，然后想让它多长就多长。
- 就lambda而言，它并没有给程序带来性能上的提升，它带来的是代码的简洁。

## try 异常处理

### try-except-else

```python
try:
    <语句>        #可能出错的代码
except <名字>：
    <语句>        #如果在try部份引发了'name'异常
except <名字>，<数据>:
    <语句>        #如果引发了'name'异常，获得附加的数据
else:
    <语句>        #如果没有异常发生
```

### try-finally

```python
try:
    <语句>
finally:
    <语句>    #退出try时总会执行
```

### raise触发异常

#### 形式

```python
raise [Exception [, args [, traceback]]]
```

#### 实例

```python
#!/usr/bin/python
# -*- coding: UTF-8 -*-

# 定义函数
def mye(level):
    if level < 1:
        raise Exception, "Invalid level!"
        # 触发异常后，后面的代码就不会再执行
try:
    mye(0)            # 触发异常
except Exception, err:
    print(1, err)
else:
    print(2)
```

输出

```shell
1 Invalid level!
```

#### 用户自定义异常

通过创建一个新的异常类，程序可以命名它们自己的异常。异常应该是典型的继承自Exception类，通过直接或间接的方式。

```python
class Networkerror(RuntimeError):
    def __init__(self, arg):
        self.args = arg

try:
    raise Networkerror("Bad hostname")
except Networkerror,e:
    print(e.args)
```

## with 上下文

### with是什么

with处理相当于`try-finally`

```python
file = open("/tmp/foo.txt")
try:
    data = file.read()
finally:
    file.close()

# 等价于

with open("/tmp/foo.txt") as file:
    data = file.read()
```

### with怎么工作

基本思想是with所求值的对象必须有一个`__enter__()`方法，一个`__exit__()`方法。

紧跟with后面的语句被求值后，返回对象的`__enter__()`方法被调用，这个方法的返回值将被赋值给as后面的变量。当with后面的代码块全部被执行完之后，将调用前面返回对象的`__exit__()`方法。

实例

```python
#!/usr/bin/env python
# with_example01.py

class Sample:
    def __enter__(self):
        print "In __enter__()"
        return "Foo"

    def __exit__(self, type, value, trace):
        print "In __exit__()"

def get_sample():
    return Sample()

with get_sample() as sample:
    print "sample:", sample
```

输出

```shell
In __enter__()
sample: Foo
In __exit__()
```

# 三、系统内置module介绍

## 1. 操作系统组件 os

### 路径相关操作

#### 获取当前路径

```python
import os

print(os.getcwd())                  #获取当前工作目录路径
print(os.path.abspath('.'))         #获取当前工作目录路径
print(os.path.abspath('test.txt'))  #获取当前目录文件下的工作目录路径
print(os.path.abspath('..'))        #获取当前工作的父目录 ！注意是父目录路径
print(os.path.abspath(os.curdir))   #获取当前工作目录路径
```

#### 改变当前路径

```python
import os

os.chdir(path)
```

#### 遍历目录

此命令会遍历目录下的所有文件包括子文件

```python
import os
for dirPath, dirNames, fileNames in os.walk('./'):
    print('dirPath', dirPath)       # 当前遍历的目录
    print('dirNames', dirNames)     # 该目录下所有的文件夹名字组成的列表
    print('fileNames', fileNames)   # 该目录下所有的文件名字组成的列表
```

### 调用可执行文件

#### 获取输出结果

```python
import os

f = os.popen("(cmd) (param)")
data = f.readlines()
f.close()
```

#### 获取返回值

```python
import os

r_v = os.system("(cmd) (param)")
print r_v
```

## 2. 系统组件 sys

### 内置常量

```python
import sys

print(sys.executable)       # 当前python命令所在路径，/usr/bin/python
```

## 3. json

### 3.1. 基本操作

```python
import json

# 字符串到dict
dict_data = json.loads('{"a": 1}')
# dict到字符串，是否排列key
json_str = json.dumps(dict_data, sort_keys=True)

```

# 四、好用的module推荐

## 1. 数据处理

数据处理相关(pandas、numpy等)的在[另一篇博客详解](/blogs/2018-10-25-dataScienceStudyPython)

## 2. 压缩

### zip格式

创建压缩

```python
import zipfile

z = zipfile.ZipFile(folderName + '.zip', 'w', zipfile.ZIP_STORED) # 创建文件
z.write('test.txt')             # 写入一个文件
z.write('dirName')              # 写入一个空文件夹
z.write('folderName/fileName')  # 可以在没有上级目录的情况下直接写一个文件
z.close()                       # 关闭文件
```

压缩目录下的所有文件

```python
import zipfile
import os

z = zipfile.ZipFile('dirName.zip', 'w', zipfile.ZIP_STORED)
for dirPath, dirNames, fileNames in os.walk('dirName'):
    for fileName in fileNames:
        z.write(dirPath + '/' + fileName)
        print(dirPath + '/' + fileName)

    # 防止空文件夹没有被添加入压缩文件
    for dirName in dirNames:
        z.write(dirPath + '/' + dirName)
        print(dirPath + '/' + dirName + '/') # 区别于文件的打印
z.close()
```

## 3. 汉字转拼音 xpinyin

简单用例

```python
import xpinyin
pin = xpinyin.Pinyin()
test1 = pin.get_pinyin("大河向东流")   #默认分割符为-
print(test1)

test2 = pin.get_pinyin("大河向东流", "")
print(test2)
```

## 4. 参数解析器 argparse

很方便的管理命令行参数，支持选项添加

## 5. 文件、文件夹对比 filecmp

一个开源比较好的文件夹对比仓库: [https://github.com/Pixinn/compare_folders](https://github.com/Pixinn/compare_folders)

## 6. git操作 gitpython

## 7. url请求操作 requests

```python
import requests

# 关闭https请求打印的warning
requests.packages.urllib3.disable_warnings()

# params对应请求后面的参数 https://127.0.0.1:1234?a=1&b=2
params = {
    "a": 1,
    "b": 2
}
# data对应表单数据
data = {
    "ab": 1,
    "cd": 2
}
# json对应body的json
json_data = {
    "abc": 1,
    "cde": 2
}
r = requests.get("https://127.0.0.1:1234", params=params)
r = requests.post("https://127.0.0.1:1234", params=params, data=data, json=json_data)
```

## 8. 接口测试框架 robot framework

### 8.1. 命令使用

```shell
# 执行tag为xxx的用例
robot -i xxx caseDir/
# 执行tag为xxx的用例，日志级别为TRACE，默认显示级别INFO
robot -i xxx -L TRACE:INFO caseDir/
```

# 五、小技巧和踩坑记

## 1. 判断文件是否为二进制

```python
import codecs
import os

#: BOMs to indicate that a file is a text file even if it contains zero bytes.
_TEXT_BOMS = (
    codecs.BOM_UTF16_BE,
    codecs.BOM_UTF16_LE,
    codecs.BOM_UTF32_BE,
    codecs.BOM_UTF32_LE,
    codecs.BOM_UTF8,
)

def is_binary_file(file_path):
    file_path = os.path.abspath(file_path)

    with open(file_path, 'rb') as file:
        initial_bytes = file.read(8192)
        file.close()
    return not any(initial_bytes.startswith(bom) for bom in _TEXT_BOMS) and b'\0' in initial_bytes
```

## 2. 动态添加PYTHONPATH

```python
import sys
sys.path.append('/xxx/xxx')
```
