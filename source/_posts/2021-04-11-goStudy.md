---
title: go语言学习
date: 2021-04-11 02:06:33
tags:
categories: [Program, Web]
---

# 一、前言

## 环境

```shell
->   go version
go version go1.16.4 linux/amd64
```

# 二、语法相关

## 1. 变量

### 1.1. 去除变量未定义提示

```go
_ = varA
```

## 2. map

### 2.1. 一些基本操作

```go
/****** map初始化 ******/
xxxMap := make(map[string]interface{})

/****** 判断map是否存在key ******/
if _, ok := xxxMap[key]; ok {
    // 存在key
}

/****** 遍历map ******/
for key, value := range xxxMap {
    // 操作map
}
```

## 3. slice

### 2.1. 一些基本操作

```go
/****** slice初始化 ******/
s0 := []int{0, 1}
s1 := []int{0, 1}

/****** slice添加元素 ******/
// go对append有处理，如果赋值给原切片，且切片空间足够/，不会新申请内存
// 如果赋值给不同切片，会新申请内存，不会更改原切片
s0 = append(s0, 2)
s0 = append(s0, 3, 4)
// 切片合并，其中s1...意味着将s1拆分成元素传入append
// 相当于调用添加多个元素
s0 = append(s0, s1...)
```

## 4. 类型断言

# 三、标准库

## 1. json

### 1.1. 一些基本操作

```go
/****** 将json字符串序列化成go对象 ******/
// 先marshal在unmarshal可以让一个未知的interface确定内部类型
// Unmarshal可以将一个json字符串解析到一个特定的格式下
// json.Unmarshal会将数字解析成float64
json.Unmarshal(jsonBytes, &target)
```

## 2. 单测 test

```go
package service

import (
	"encoding/json"
	"errors"
	"reflect"
	"sort"
	"testing"

	"github.com/gin-gonic/gin"

	. "github.com/agiledragon/gomonkey"
	. "github.com/smartystreets/goconvey/convey"
)

func TestFunc(t *testing.T) {
	sess := session.Session{}
	var s *session.Session

    // hook类的成员函数Commit
	patch := ApplyMethod(reflect.TypeOf(s), "Commit", func(_ *session.Session) error { return nil })
	defer patch.Reset()

    // 使用Convey包裹，可以按照分组测试
	Convey("TestFunc", t, func() {
		Convey("正常流程", func() {
			Convey("插入单个数据", func() {
				sess.New()
                ...
                // So确定
				So(tmp, ShouldResemble, []string{"aaa"})
			})
		})
		Convey("异常流程", func() {
			Convey("GetSessionData出错", func() {
				sess.New()
				...
				patch1 := ApplyMethod(reflect.TypeOf(s), "GetSessionData",
					func(_ *session.Session, _ string) (interface{}, error) {
						return nil, errors.New("testErr")
					})
				...
				So(tmp, ShouldResemble, []string{})
				patch1.Reset()
				...
				So(tmp, ShouldResemble, []string{"bbb"})
			})
		})
	})
}

```
