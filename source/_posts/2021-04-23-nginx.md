---
title: nginx配置和源码分析
date: 2021-04-23 11:08:40
tags: [网络]
categories: [Program, Web]
---

# 一、配置

## 1. 配置实例

### 1.1. 80端口转443

```conf
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    rewrite ^ https://$http_host$request_uri? permanent;
}
```

### 1.2. 请求url代理到另一个地址

- proxy_pass会自动将get参数和post参数带到代理的地址去，不需要加上`$query_string`

```conf
location /test {
    # 代理地址如果不带后面地址，将会请求 http://127.0.0.1:1234/test
    proxy_pass      http://127.0.0.1:1234
    
    # 代理地址如果带后面地址，将会请求 http://127.0.0.1:1234/aaa
    proxy_pass      http://127.0.0.1:1234/aaa
}

# 假设请求的地址为 http://x.x.x.x/test/bbb
location /test/ {
    # 代理地址如果不带后面地址，将会请求 http://127.0.0.1:1234/test/bbb
    proxy_pass      http://127.0.0.1:1234

    # 代理地址如果带后面地址，将会请求 http://127.0.0.1:1234/aaabbb
    # 由于location加了/，proxy_pass会删除/test/，剩下bbb拼接到后面url
    proxy_pass      http://127.0.0.1:1234/aaa

    # 代理地址如果带后面地址，将会请求 http://127.0.0.1:1234/aaa/bbb
    proxy_pass      http://127.0.0.1:1234/aaa/
}
```

# 二、源码分析

## 1. 流程实例

### 1.1. https请求证书认证握手的流程


